<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GanSO</title>
    <!-- Carrega o Tailwind CSS para estilização -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome para os ícones de estrela -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Configuração de estilo personalizada do Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#121212', // Fundo escuro
                        'secondary': '#1E88E5', // Azul principal
                        'accent': '#03A9F4', // Azul de destaque
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: white;
        }

        /* Animação para a rolagem do dado */
        @keyframes roll {
            0% { transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg); }
            100% { transform: rotateX(720deg) rotateY(720deg) rotateZ(720deg); }
        }

        .rolling {
            animation: roll 1s ease-out;
        }

        .roll-message {
            animation: fade-in 0.5s ease-in-out;
        }

        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .animate-pulse-slow {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* Estilo para as estrelas */
        .stars .fa-star {
            color: #ccc;
        }
        .stars .text-yellow-400 {
            color: #FACC15;
        }

    </style>
</head>
<body class="bg-primary text-gray-200 min-h-screen flex flex-col items-center p-4">
    <div class="container mx-auto px-4 py-8 max-w-2xl bg-gray-900 rounded-xl shadow-lg border border-gray-700">
        <!-- Título e Contexto -->
        <header class="text-center mb-6">
            <h1 class="text-4xl font-bold text-accent mb-2">GanSO</h1>
            <h2 class="text-xl text-white" id="round-info">Rodada: 1 | Casa: 0</h2>
        </header>

        <!-- Seção de Status do Jogador -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6 border border-gray-700">
            <h3 class="text-lg font-semibold text-secondary mb-2">Status do Processador</h3>
            <div class="flex justify-between items-center mb-2">
                <p>CPU:</p>
                <div class="w-2/3 h-4 bg-gray-700 rounded-full">
                    <div id="cpu-bar" class="h-4 bg-green-500 rounded-full transition-all duration-500" style="width: 0%;"></div>
                </div>
                <span id="cpu-text" class="text-sm ml-2">0%</span>
            </div>
            <div class="flex justify-between items-center">
                <p>RAM:</p>
                <div class="w-2/3 h-4 bg-gray-700 rounded-full">
                    <div id="ram-bar" class="h-4 bg-green-500 rounded-full transition-all duration-500" style="width: 0%;"></div>
                </div>
                <span id="ram-text" class="text-sm ml-2">0%</span>
            </div>
        </div>
        
        <!-- Estado atual do jogo -->
        <div id="game-state" class="text-center p-4 rounded-lg mb-6 text-gray-300">
            <p id="game-message" class="text-lg">Processo em Execução.</p>
        </div>

        <!-- Seção de Rolagem do Dado e Jogo -->
        <div class="text-center mb-6 flex flex-col items-center">
            <div id="dice-container" class="w-16 h-16 bg-gray-700 rounded-lg mb-4 flex items-center justify-center text-4xl font-bold text-white shadow-lg transition-transform duration-200 transform">
                ?
            </div>
            <p id="roll-message" class="text-3xl font-bold text-accent mb-4 roll-message"></p>
            
            <div id="game-controls" class="flex justify-center items-center space-x-4">
                <button id="stay-put-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold w-32 h-12 flex items-center justify-center rounded-lg shadow-lg transition-transform duration-200 transform hover:scale-105 active:scale-95">
                    Ficar Parado
                </button>
                <button id="roll-dice-btn" class="bg-secondary hover:bg-accent text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform duration-200 transform hover:scale-105 active:scale-95">
                    Rolar Dado
                </button>
                <button id="reroll-dice-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold w-32 h-12 flex items-center justify-center rounded-lg shadow-lg transition-transform duration-200 transform hover:scale-105 active:scale-95">
                    Rejogar
                </button>
            </div>
        </div>

        <!-- Seção de Perguntas e Respostas (escondida por padrão) -->
        <div id="question-area" class="bg-gray-800 rounded-lg p-6 border border-gray-700 hidden">
            <div id="difficulty-buttons" class="flex flex-col space-y-2 mb-4">
                <p class="text-gray-400 text-center">Escolha a dificuldade da casa:</p>
                <button data-difficulty="facil" class="difficulty-btn bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center">
                    <span class="stars">
                        <i class="fas fa-star text-yellow-400"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </span>
                    <span class="ml-2">Fácil (30% CPU, 20% RAM)</span>
                </button>
                <button data-difficulty="medio" class="difficulty-btn bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center">
                    <span class="stars">
                        <i class="fas fa-star text-yellow-400"></i>
                        <i class="fas fa-star text-yellow-400"></i>
                        <i class="fas fa-star"></i>
                    </span>
                    <span class="ml-2">Médio (25% CPU, 25% RAM)</span>
                </button>
                <button data-difficulty="dificil" class="difficulty-btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center">
                    <span class="stars">
                        <i class="fas fa-star text-yellow-400"></i>
                        <i class="fas fa-star text-yellow-400"></i>
                        <i class="fas fa-star text-yellow-400"></i>
                    </span>
                    <span class="ml-2">Difícil (20% CPU, 30% RAM)</span>
                </button>
            </div>
        </div>

        <!-- Seção de Ação (Respostas - escondida por padrão) -->
        <div id="action-area" class="bg-gray-800 rounded-lg p-6 border border-gray-700 hidden">
            <!-- A pergunta será exibida aqui -->
            <p class="text-lg mb-4 text-center" id="action-prompt"></p>
            <div class="flex justify-center space-x-4">
                <button id="correct-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-transform duration-200 transform hover:scale-105">Acertou!</button>
                <button id="wrong-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-transform duration-200 transform hover:scale-105">Errou</button>
            </div>
        </div>

        <!-- Log do Jogo -->
        <div class="mt-8">
            <h3 class="text-lg font-semibold text-secondary mb-2">Log de Eventos</h3>
            <div id="log" class="bg-gray-800 rounded-lg p-4 h-48 overflow-y-auto text-sm text-gray-400 border border-gray-700">
                <!-- Log entries will be added here -->
            </div>
        </div>
    </div>

    <script>
        // Dados do jogo
        const gameData = {
            questions: {
                facil: [
                    "O que significa a sigla SO?", "Cite um exemplo de sistema operacional.", "Qual empresa desenvolve o Windows?", "O Linux é de código aberto ou fechado?", "O que é um arquivo em um sistema operacional?", "O que é um diretório?", "Cite um sistema operacional de smartphone.", "Qual tecla no Windows abre o Gerenciador de Tarefas junto com Ctrl+Alt?", "O que é memória RAM usada pelo SO?", "O que acontece quando ligamos o computador?", "O que significa a sigla CPU?", "O que é um processo?", "No Linux, o diretório raiz é representado por qual símbolo?", "Cite um exemplo de chamada de sistema.", "Qual sistema operacional vem nos celulares da Apple?", "O que significa a sigla I/O?", "O que é um driver no SO?", "Qual comando é usado no Windows para listar arquivos em um diretório?", "Qual comando é usado no Linux para listar arquivos?", "O que é um kernel?", "Cite uma operação básica que pode ser feita em um arquivo.", "Qual a função de um antivírus em relação ao SO?", "O que é um backup?", "Cite um exemplo de sistema de arquivos.", "O que significa login em um sistema operacional?"
                ],
                medio: [
                    "Qual a diferença entre hardware e software?", "O que significa que um SO é multitarefa?", "Qual a função principal do sistema de arquivos?", "O que significa a sigla PCB (Process Control Block)?", "Cite dois exemplos de sistemas de arquivos.", "Qual a diferença entre memória volátil e não volátil?", "O que é um dispositivo de entrada? Cite um exemplo.", "O que é um dispositivo de saída? Cite um exemplo.", "O que é uma interrupção em SO?", "O que é login e senha em um sistema?", "O que significa read, write, execute (rwx) em arquivos?", "No Linux, o que é um soft link?", "No Linux, o que é um hard link?", "O que é fragmentação em um disco?", "Cite duas funções da cache de disco.", "Qual a função do MBR (Master Boot Record)?", "O que é um quantum no escalonamento Round Robin?", "Qual a diferença entre FIFO e SJF?", "O que é um deadlock?", "O que é o dispatcher em um sistema operacional?", "Cite três operações básicas em arquivos.", "O que é memória virtual?", "Cite um método de alocação de arquivos no disco.", "O que significa o conceito de partição em discos?", "O que é multithreading?"
                ],
                dificil: [
                    "Explique a diferença entre processo e programa.", "Diferencie kernel monolítico e microkernel.", "Explique como funciona a memória virtual com paginação.", "O que é thrashing em memória virtual?", "Descreva como funciona o algoritmo de substituição de páginas LRU.", "O que significa context switch e por que ele é custoso?", "Diferencie escalonamento preemptivo e não preemptivo.", "Quais são os três níveis de escalonamento (longo, médio, curto)?", "Qual a diferença entre prioridade estática e dinâmica em escalonamento?", "Como funciona o Round Robin e qual seu problema principal?", "Explique o problema de starvation.", "Como o aging resolve o problema de starvation?", "Explique como funciona a alocação contígua de arquivos no disco.", "Explique como funciona a alocação encadeada de arquivos no disco.", "Explique como funciona a alocação indexada de arquivos no disco.", "O que é o VFS (Virtual File System)?", "Qual a função das tabelas TDAA e TAAP em arquivos abertos?", "Diferencie os métodos de acesso a arquivos sequencial e relativo.", "O que é um descritor de arquivo?", "Diferencie um sistema batch de um sistema time-sharing.", "O que são as condições de Coffman para deadlock?", "Explique o papel do dispatcher no chaveamento de contexto.", "Quais são os principais objetivos do escalonamento de processos?", "Explique a diferença entre multithreading em nível de usuário e em nível de kernel."
                ]
            },
            discardPiles: {
                facil: [],
                medio: [],
                dificil: []
            },
            player: {
                cpu: 0,
                ram: 0,
                blocked: false,
                position: 0
            },
            round: 1,
            resourceQueue: [] // Fila para gerenciar recursos
        };

        // Referências aos elementos da UI
        const rollDiceBtn = document.getElementById('roll-dice-btn');
        const stayPutBtn = document.getElementById('stay-put-btn');
        const rerollDiceBtn = document.getElementById('reroll-dice-btn');
        const diceContainer = document.getElementById('dice-container');
        const rollMessageEl = document.getElementById('roll-message');
        const questionArea = document.getElementById('question-area');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        const actionArea = document.getElementById('action-area');
        const actionPromptEl = document.getElementById('action-prompt');
        const correctBtn = document.getElementById('correct-btn');
        const wrongBtn = document.getElementById('wrong-btn');
        const cpuBar = document.getElementById('cpu-bar');
        const ramBar = document.getElementById('ram-bar');
        const cpuText = document.getElementById('cpu-text');
        const ramText = document.getElementById('ram-text');
        const logEl = document.getElementById('log');
        const gameMessageEl = document.getElementById('game-message');
        const roundInfoEl = document.getElementById('round-info');

        // Adiciona uma mensagem ao log do jogo
        function addLog(message, color = 'text-gray-400') {
            const entry = document.createElement('p');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            entry.className = `mt-1 ${color}`;
            logEl.prepend(entry);
            if (logEl.childElementCount > 20) {
                logEl.removeChild(logEl.lastChild);
            }
        }
        
        // Libera recursos mais antigos (mais de 5 rodadas) da fila
        function freeOldResources() {
            const resourcesToFree = gameData.resourceQueue.filter(resource => gameData.round - resource.round >= 5 && resource.cpu > 0);
            
            if (resourcesToFree.length > 0) {
                resourcesToFree.forEach(resource => {
                    const cpuLib = resource.cpu;
                    const ramLib = resource.ram;
                     addLog(`Recursos da rodada ${resource.round} liberados: -${Math.round(cpuLib)}% CPU e -${Math.round(ramLib)}% RAM.`, 'text-lime-400');
                });
            }

            // Atualiza a fila removendo os recursos liberados
            gameData.resourceQueue = gameData.resourceQueue.filter(resource => gameData.round - resource.round < 5);
        }

        // Atualiza a interface do usuário com os valores de CPU e RAM
        function updatePlayerUI() {
            // Re-calcula a CPU e RAM com base na fila de recursos
            gameData.player.cpu = gameData.resourceQueue.reduce((sum, res) => sum + res.cpu, 0);
            gameData.player.ram = gameData.resourceQueue.reduce((sum, res) => sum + res.ram, 0);

            // Garante que os valores fiquem entre 0 e 100
            gameData.player.cpu = Math.max(0, Math.min(gameData.player.cpu, 100));
            gameData.player.ram = Math.max(0, Math.min(gameData.player.ram, 100));

            cpuBar.style.width = `${gameData.player.cpu}%`;
            ramBar.style.width = `${gameData.player.ram}%`;
            cpuText.textContent = `${Math.round(gameData.player.cpu)}%`;
            ramText.textContent = `${Math.round(gameData.player.ram)}%`;

            roundInfoEl.textContent = `Rodada: ${gameData.round} | Casa: ${gameData.player.position}`;

            // Mudar cor das barras
            if (gameData.player.cpu >= 70) cpuBar.classList.replace('bg-green-500', 'bg-red-500');
            else cpuBar.classList.replace('bg-red-500', 'bg-green-500');

            if (gameData.player.ram >= 70) ramBar.classList.replace('bg-green-500', 'bg-red-500');
            else ramBar.classList.replace('bg-red-500', 'bg-green-500');

            // Habilita ou desabilita os botões de controle com base no estado do jogo
            const isChoosingDifficulty = !questionArea.classList.contains('hidden');
            const isAnsweringQuestion = !actionArea.classList.contains('hidden');
            
            if (gameData.player.cpu > 100 || gameData.player.ram > 100) {
                gameData.player.blocked = true;
                rollDiceBtn.disabled = true;
                stayPutBtn.disabled = false;
                rerollDiceBtn.disabled = true;
                rollDiceBtn.classList.add('animate-pulse-slow');
                gameMessageEl.textContent = 'Recursos esgotados! Processo bloqueado. Use "Ficar Parado" para liberar recursos.';
                addLog('PROCESSO BLOQUEADO: Recursos esgotados!', 'text-red-400');
            } else if (gameData.player.cpu === 100 || gameData.player.ram === 100) {
                gameData.player.blocked = true;
                rollDiceBtn.disabled = true;
                stayPutBtn.disabled = false;
                rerollDiceBtn.disabled = true;
                let resource = '';
                if (gameData.player.cpu === 100 && gameData.player.ram === 100) {
                    resource = 'CPU e RAM';
                } else if (gameData.player.cpu === 100) {
                    resource = 'CPU';
                } else {
                    resource = 'RAM';
                }
                gameMessageEl.textContent = `${resource} no limite! Próximo consumo pode causar um deadlock.`;
                addLog(`${resource} no limite! Próximo consumo pode causar um deadlock.`, 'text-yellow-400');
            } else if (isAnsweringQuestion) {
                 rollDiceBtn.disabled = true;
                 stayPutBtn.disabled = true;
                 rerollDiceBtn.disabled = true;
            } else if (isChoosingDifficulty) {
                gameData.player.blocked = false;
                rollDiceBtn.disabled = true;
                stayPutBtn.disabled = true;
                rerollDiceBtn.disabled = false;
            } else {
                gameData.player.blocked = false;
                rollDiceBtn.classList.remove('animate-pulse-slow');
                rollDiceBtn.disabled = false;
                stayPutBtn.disabled = false;
                rerollDiceBtn.disabled = true;
            }
        }

        // Funções da lógica do jogo
        const rollDice = () => {
            if (gameData.player.blocked) {
                gameMessageEl.textContent = 'Você está bloqueado! Libere recursos para continuar.';
                addLog('Tentativa de jogada falhou. Processo bloqueado.');
                updatePlayerUI();
                return;
            }

            // Animação do dado
            diceContainer.textContent = '?';
            diceContainer.classList.add('rolling');
            
            setTimeout(() => {
                const roll = Math.floor(Math.random() * 6) + 1;
                diceContainer.classList.remove('rolling');
                diceContainer.textContent = roll;
                rollMessageEl.textContent = `Resultado do dado: ${roll}`;
                gameData.player.lastRoll = roll; // Armazena o último resultado do dado
                addLog(`Dado rolado. Resultado: ${roll}`);
                
                // Mostra a área para escolher a dificuldade
                questionArea.classList.remove('hidden');
                gameMessageEl.textContent = 'Escolha a dificuldade da casa.';
                updatePlayerUI();
            }, 1000); // 1 segundo para a animação
        };

        const drawQuestion = (difficulty) => {
            let pile = gameData.questions[difficulty];
            let discardPile = gameData.discardPiles[difficulty];

            // Se a pilha de perguntas está vazia, reabastece e embaralha
            if (pile.length === 0) {
                addLog('Pilha de perguntas vazia! Reabastecendo e embaralhando.');
                gameData.questions[difficulty] = discardPile.sort(() => Math.random() - 0.5);
                gameData.discardPiles[difficulty] = [];
                pile = gameData.questions[difficulty];
            }

            // Garante que a pilha não está vazia após a tentativa de reabastecer
            if (pile.length > 0) {
                // Remove e retorna uma pergunta aleatória
                const randomIndex = Math.floor(Math.random() * pile.length);
                const question = pile.splice(randomIndex, 1)[0];
                discardPile.push(question);
                return question;
            }

            return "Nenhuma pergunta disponível.";
        };

        const handleDifficultyClick = (event) => {
            const difficulty = event.currentTarget.dataset.difficulty;
            const { cpu, ram } = getResourceCosts(difficulty);
            
            const newCpu = Math.round(gameData.player.cpu + cpu);
            const newRam = Math.round(gameData.player.ram + ram);

            // Verifica se a ação causará um bloqueio
            if (newCpu > 100 || newRam > 100) {
                addLog('Falta de recursos!', 'text-red-400');
                gameData.resourceQueue.push({ round: gameData.round, cpu: cpu, ram: ram });
                gameData.round++; // Passa a rodada
                addLog(`Nova rodada iniciada: ${gameData.round}`, 'text-blue-400');
                updatePlayerUI();
                questionArea.classList.add('hidden'); // Oculta a área de escolha de dificuldade
                return;
            }

            const question = drawQuestion(difficulty);
            
            actionPromptEl.textContent = question;
            questionArea.classList.add('hidden');
            actionArea.classList.remove('hidden');
            
            gameData.player.currentDifficulty = difficulty;
            gameData.player.currentQuestion = question;
            addLog(`Puxou uma carta de dificuldade: ${difficulty}.`);
            addLog(`Consumo de recursos: +${cpu}% CPU e +${ram}% RAM.`);
            gameMessageEl.textContent = 'Responda a pergunta para avançar.';
            gameData.resourceQueue.push({ round: gameData.round, cpu: cpu, ram: ram });
            updatePlayerUI();
        };

        const handleAnswer = (isCorrect) => {
            if (isCorrect) {
                gameData.player.position += gameData.player.lastRoll;
                addLog(`Resposta correta! Avançou ${gameData.player.lastRoll} casas.`, 'text-green-400');
            } else {
                gameData.player.position -= 1; // Volta uma casa
                addLog(`Resposta incorreta! Voltou 1 casa (rollback).`, 'text-red-400');
            }
            
            // Incrementa a rodada e atualiza o texto da rodada
            gameData.round++;
            addLog(`Nova rodada iniciada: ${gameData.round}`, 'text-blue-400');
            
            // Libera recursos mais antigos da fila
            freeOldResources();
            
            // Esconde a área de perguntas e mostra os botões de controle
            actionArea.classList.add('hidden');
            gameMessageEl.textContent = 'Sua vez de jogar. Escolha uma ação!';
            updatePlayerUI();
            
        };

        const handleStayPut = () => {
            const cpuFreed = Math.round(Math.min(gameData.player.cpu, 20));
            const ramFreed = Math.round(Math.min(gameData.player.ram, 30));
            
            gameData.resourceQueue.push({ round: gameData.round, cpu: -cpuFreed, ram: -ramFreed });

            addLog(`Ficou parado! Liberou recursos: -${cpuFreed}% CPU e -${ramFreed}% RAM.`, 'text-blue-400');
            
            // Passa a rodada
            gameData.round++;
            addLog(`Nova rodada iniciada: ${gameData.round}`, 'text-blue-400');
            
            // Libera recursos mais antigos da fila
            freeOldResources();
            
            updatePlayerUI();
        };

        const handleRerollDice = () => {
            if (questionArea.classList.contains('hidden')) {
                return;
            }
            
            const cpuCost = 30;
            const newCpu = Math.round(gameData.player.cpu + cpuCost);

            if (newCpu > 100) {
                addLog('Falta de recursos!', 'text-red-400');
                gameData.resourceQueue.push({ round: gameData.round, cpu: cpuCost, ram: 0 });
                gameData.round++; // Passa a rodada
                addLog(`Nova rodada iniciada: ${gameData.round}`, 'text-blue-400');
                updatePlayerUI();
                questionArea.classList.add('hidden');
                return;
            }
            
            gameData.resourceQueue.push({ round: gameData.round, cpu: cpuCost, ram: 0 });
            addLog('Rejogou o dado. Custo: +30% CPU.', 'text-purple-400');
            updatePlayerUI();
            rollDice(); // Chama a função de rolagem
        };


        const getResourceCosts = (difficulty) => {
            switch (difficulty) {
                case 'facil': return { cpu: 30, ram: 20 };
                case 'medio': return { cpu: 25, ram: 25 };
                case 'dificil': return { cpu: 20, ram: 30 };
                default: return { cpu: 0, ram: 0 };
            }
        };

        // Event Listeners
        rollDiceBtn.addEventListener('click', rollDice);
        stayPutBtn.addEventListener('click', handleStayPut);
        rerollDiceBtn.addEventListener('click', handleRerollDice);
        difficultyButtons.forEach(btn => btn.addEventListener('click', handleDifficultyClick));
        correctBtn.addEventListener('click', () => handleAnswer(true));
        wrongBtn.addEventListener('click', () => handleAnswer(false));

        // Inicializa o jogo ao carregar a página
        updatePlayerUI();
        addLog('Início do jogo! Processador pronto para executar.');
    </script>
</body>
</html>
